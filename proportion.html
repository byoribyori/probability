<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="proportion.css">
  <title>割合計算</title>
</head>
<body>
  <table id="table">
    <tr>
      <th>
        合計<span id="total">0</span>
      </th>
      <th style="width:100px;">
        <button onclick="plus()">欄を追加</button>
      </th>
    </tr>
    <tr>
      <th>
        <input type="tel" onkeyup="update()">
      </th>
      <th>
        <div id=d1></div>
      </th>
    </tr>
    <tr>
      <th>
        <input type="tel" onkeyup="update()">
      </th>
      <th>
        <div id=d2></div>
      </th>
    </tr>
    <span id="tab"></span>
  </table>
  <script>
    function update() {
      var value = [];
      var total = 0;
      var inputs = document.getElementsByTagName('input');
      for (var i = 0; i < inputs.length; i++) {
        value.push(Number(inputs[i].value));
        total += value[i];
      }
      document.getElementById('total').innerText = total;
      for (var ii = 0; ii < value.length; ii++) {
        var result = Math.round(value[ii] / total * 10000) / 100
        document.getElementById(`d${ii + 1}`).innerText = isNaN(result) ? '' : result + '%';
      }
    }

    function plus() {
      var th1 = document.createElement('th');
      th1.innerHTML = '<input type="tel" onkeyup="update()">';
      var th2 = document.createElement('th');
      var number = document.getElementsByTagName('input').length + 1;
      th2.innerHTML = `<div id=d${number}></div>`
      var tr = document.createElement('tr');
      tr.appendChild(th1);
      tr.appendChild(th2);
      document.getElementById('table').appendChild(tr);
    }
  </script>
</body>
</html>
